{"ast":null,"code":"import _slicedToArray from\"D:/Projects/Alexandria/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from'react';import Axios from'axios';import{withRouter}from'react-router-dom';import{BeatLoader}from'react-spinners';import'react-toastify/dist/ReactToastify.css';import{DescendingIcon,AscendingIcon}from'../partial/icons';import Book from'./partial/book';import{app}from'../../firebase/index';var qs=require('qs');function Books(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).genre),_useState4=_slicedToArray(_useState3,1),genre=_useState4[0];var _useState5=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).orderby),_useState6=_slicedToArray(_useState5,1),sortBy=_useState6[0];var _useState7=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).descending),_useState8=_slicedToArray(_useState7,1),descending=_useState8[0];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];useEffect(function(){var mounted=true;var APIRequest=\"http://localhost:8000/api/books/getAll?genre=\".concat(genre?genre:'',\"&orderby=\").concat(sortBy?sortBy:'title',\"&descending=\").concat(descending?descending:'false');Axios.get(APIRequest,{withCredentials:true}).then(function(res){if(mounted){setBooks(res.data);setLoading(false);}}).catch(function(){return props.history.push('/error');});return function(){mounted=false;};},[descending,genre,sortBy,props.history]);// Saves the sorting options in the URL\nvar redirect=function redirect(genre,orderBy,descending){props.history.push({pathname:'/admin/books',search:\"?genre=\".concat(genre?genre:'',\"&orderby=\").concat(orderBy?orderBy:'title',\"&descending=\").concat(descending?descending:'false')});window.location.reload();};var remove=function remove(id,image){Axios.post('http://localhost:8000/api/admin/remove',{id:id},{withCredentials:true}).then(function(){var storageRef=app.storage().ref();storageRef.child(image).delete();window.location.reload();}).catch(function(){return props.history.push('/error');});};var bookList=books.map(function(book){return/*#__PURE__*/_jsx(Book,{book:book,remove:remove},book.title);});if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(BeatLoader,{loading:true})});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return props.history.push('/admin');},children:\"Back to admin panel\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"genre-title\",children:genre}),/*#__PURE__*/_jsx(\"div\",{className:\"sort-options-container\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"order-by-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Order by:\\xA0\",/*#__PURE__*/_jsxs(\"select\",{value:sortBy,onChange:function onChange(e){return redirect(genre,e.target.value,descending);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"author\",children:\"Author\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price\",children:\"Price\"})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return redirect(genre,sortBy,descending==='true'?'false':'true');},children:descending==='true'?/*#__PURE__*/_jsx(DescendingIcon,{width:\"20\",height:\"20\"}):/*#__PURE__*/_jsx(AscendingIcon,{width:\"20\",height:\"20\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"book-container\",children:bookList})]});}export default withRouter(Books);","map":{"version":3,"sources":["D:/Projects/Alexandria/client/src/components/admin/books.jsx"],"names":["React","useState","useEffect","Axios","withRouter","BeatLoader","DescendingIcon","AscendingIcon","Book","app","qs","require","Books","props","books","setBooks","parse","location","search","ignoreQueryPrefix","genre","orderby","sortBy","descending","loading","setLoading","mounted","APIRequest","get","withCredentials","then","res","data","catch","history","push","redirect","orderBy","pathname","window","reload","remove","id","image","post","storageRef","storage","ref","child","delete","bookList","map","book","title","e","target","value"],"mappings":"4OAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,KAAyC,OAAzC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,UAAR,KAAyB,kBAAzB,CACA,OAAQC,UAAR,KAAyB,gBAAzB,CACA,MAAO,uCAAP,CACA,OAAQC,cAAR,CAAwBC,aAAxB,KAA4C,kBAA5C,CACA,MAAOC,CAAAA,IAAP,KAAiB,gBAAjB,CACA,OAAQC,GAAR,KAAkB,sBAAlB,CACA,GAAMC,CAAAA,EAAE,CAAGC,OAAO,CAAC,IAAD,CAAlB,CAEA,QAASC,CAAAA,KAAT,CAAeC,KAAf,CAAqB,eACSZ,QAAQ,CAAC,EAAD,CADjB,wCACVa,KADU,eACHC,QADG,8BAEDd,QAAQ,CAACS,EAAE,CAACM,KAAH,CAASH,KAAK,CAACI,QAAN,CAAeC,MAAxB,CAAgC,CAACC,iBAAiB,CAAE,IAApB,CAAhC,EAA2DC,KAA5D,CAFP,yCAEVA,KAFU,8BAGAnB,QAAQ,CAACS,EAAE,CAACM,KAAH,CAASH,KAAK,CAACI,QAAN,CAAeC,MAAxB,CAAgC,CAACC,iBAAiB,CAAE,IAApB,CAAhC,EAA2DE,OAA5D,CAHR,yCAGVC,MAHU,8BAIIrB,QAAQ,CAACS,EAAE,CAACM,KAAH,CAASH,KAAK,CAACI,QAAN,CAAeC,MAAxB,CAAgC,CAACC,iBAAiB,CAAE,IAApB,CAAhC,EAA2DI,UAA5D,CAJZ,yCAIVA,UAJU,8BAKatB,QAAQ,CAAC,IAAD,CALrB,0CAKVuB,OALU,gBAKDC,UALC,gBAOjBvB,SAAS,CAAC,UAAM,CACZ,GAAIwB,CAAAA,OAAO,CAAG,IAAd,CAEA,GAAMC,CAAAA,UAAU,wDAAmDP,KAAK,CAAGA,KAAH,CAAW,EAAnE,qBAAiFE,MAAM,CAAGA,MAAH,CAAY,OAAnG,wBAAyHC,UAAU,CAAGA,UAAH,CAAgB,OAAnJ,CAAhB,CACApB,KAAK,CAACyB,GAAN,CAAUD,UAAV,CAAsB,CAACE,eAAe,CAAE,IAAlB,CAAtB,EACCC,IADD,CACM,SAAAC,GAAG,CAAI,CACT,GAAGL,OAAH,CAAW,CACPX,QAAQ,CAACgB,GAAG,CAACC,IAAL,CAAR,CACAP,UAAU,CAAC,KAAD,CAAV,CACH,CACJ,CAND,EAOCQ,KAPD,CAOO,iBAAMpB,CAAAA,KAAK,CAACqB,OAAN,CAAcC,IAAd,CAAmB,QAAnB,CAAN,EAPP,EASA,MAAO,WAAM,CACTT,OAAO,CAAG,KAAV,CACH,CAFD,CAGH,CAhBQ,CAgBN,CAACH,UAAD,CAAaH,KAAb,CAAoBE,MAApB,CAA4BT,KAAK,CAACqB,OAAlC,CAhBM,CAAT,CAkBA;AACA,GAAME,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAChB,KAAD,CAAQiB,OAAR,CAAiBd,UAAjB,CAAgC,CAC7CV,KAAK,CAACqB,OAAN,CAAcC,IAAd,CAAmB,CACfG,QAAQ,CAAE,cADK,CAEfpB,MAAM,kBAAYE,KAAK,CAAGA,KAAH,CAAW,EAA5B,qBAA0CiB,OAAO,CAAGA,OAAH,CAAa,OAA9D,wBAAoFd,UAAU,CAAGA,UAAH,CAAgB,OAA9G,CAFS,CAAnB,EAIEgB,MAAM,CAACtB,QAAP,CAAgBuB,MAAhB,GACL,CAND,CAQA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACC,EAAD,CAAKC,KAAL,CAAe,CAC1BxC,KAAK,CAACyC,IAAN,CAAW,wCAAX,CAAqD,CAACF,EAAE,CAAEA,EAAL,CAArD,CAA+D,CAACb,eAAe,CAAE,IAAlB,CAA/D,EACCC,IADD,CACM,UAAM,CACR,GAAMe,CAAAA,UAAU,CAAGpC,GAAG,CAACqC,OAAJ,GAAcC,GAAd,EAAnB,CACAF,UAAU,CAACG,KAAX,CAAiBL,KAAjB,EAAwBM,MAAxB,GACAV,MAAM,CAACtB,QAAP,CAAgBuB,MAAhB,GACH,CALD,EAMCP,KAND,CAMO,iBAAMpB,CAAAA,KAAK,CAACqB,OAAN,CAAcC,IAAd,CAAmB,QAAnB,CAAN,EANP,EAOH,CARD,CAUA,GAAMe,CAAAA,QAAQ,CAAGpC,KAAK,CAACqC,GAAN,CAAU,SAAAC,IAAI,CAAI,CAC/B,mBAAO,KAAC,IAAD,EAAM,IAAI,CAAEA,IAAZ,CAAkB,MAAM,CAAEX,MAA1B,EAAuCW,IAAI,CAACC,KAA5C,CAAP,CACH,CAFgB,CAAjB,CAIA,GAAG7B,OAAH,CAAW,CACP,mBAAO,YAAK,SAAS,CAAC,mBAAf,uBAAmC,KAAC,UAAD,EAAY,OAAO,KAAnB,EAAnC,EAAP,CACH,CAED,mBACI,oCACI,eAAQ,OAAO,CAAE,yBAAMX,CAAAA,KAAK,CAACqB,OAAN,CAAcC,IAAd,CAAmB,QAAnB,CAAN,EAAjB,iCADJ,cAEI,WAAI,SAAS,CAAC,aAAd,UAA6Bf,KAA7B,EAFJ,cAGI,YAAK,SAAS,CAAC,wBAAf,uBACI,cAAM,SAAS,CAAC,eAAhB,wBACI,sDAEI,gBAAQ,KAAK,CAAEE,MAAf,CAAuB,QAAQ,CAAE,kBAACgC,CAAD,QAAOlB,CAAAA,QAAQ,CAAChB,KAAD,CAAQkC,CAAC,CAACC,MAAF,CAASC,KAAjB,CAAwBjC,UAAxB,CAAf,EAAjC,wBACI,eAAQ,KAAK,CAAC,OAAd,mBADJ,cAEI,eAAQ,KAAK,CAAC,QAAd,oBAFJ,cAGI,eAAQ,KAAK,CAAC,OAAd,mBAHJ,GAFJ,GADJ,cASI,eAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAE,yBAAMa,CAAAA,QAAQ,CAAChB,KAAD,CAAQE,MAAR,CAAgBC,UAAU,GAAK,MAAf,CAAwB,OAAxB,CAAkC,MAAlD,CAAd,EAA/B,UACCA,UAAU,GAAK,MAAf,cAAwB,KAAC,cAAD,EAAgB,KAAK,CAAC,IAAtB,CAA2B,MAAM,CAAC,IAAlC,EAAxB,cACC,KAAC,aAAD,EAAe,KAAK,CAAC,IAArB,CAA0B,MAAM,CAAC,IAAjC,EAFF,EATJ,GADJ,EAHJ,cAmBI,YAAK,SAAS,CAAC,gBAAf,UACK2B,QADL,EAnBJ,GADJ,CAyBH,CAED,cAAe9C,CAAAA,UAAU,CAACQ,KAAD,CAAzB","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport Axios from 'axios';\r\nimport {withRouter} from 'react-router-dom';\r\nimport {BeatLoader} from 'react-spinners';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport {DescendingIcon, AscendingIcon} from '../partial/icons';\r\nimport Book from './partial/book';\r\nimport {app} from '../../firebase/index';\r\nconst qs = require('qs');\r\n\r\nfunction Books(props){\r\n    const [books, setBooks] = useState([]);\r\n    const [genre] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).genre);\r\n    const [sortBy] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).orderby);\r\n    const [descending] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).descending);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        const APIRequest = `http://localhost:8000/api/books/getAll?genre=${genre ? genre : ''}&orderby=${sortBy ? sortBy : 'title'}&descending=${descending ? descending : 'false'}`;\r\n        Axios.get(APIRequest, {withCredentials: true})\r\n        .then(res => {\r\n            if(mounted){\r\n                setBooks(res.data);\r\n                setLoading(false);\r\n            }\r\n        })\r\n        .catch(() => props.history.push('/error'));\r\n\r\n        return () => {\r\n            mounted = false;\r\n        }\r\n    }, [descending, genre, sortBy, props.history]);\r\n\r\n    // Saves the sorting options in the URL\r\n    const redirect = (genre, orderBy, descending) => {\r\n        props.history.push({\r\n            pathname: '/admin/books',\r\n            search: `?genre=${genre ? genre : ''}&orderby=${orderBy ? orderBy : 'title'}&descending=${descending ? descending : 'false'}`\r\n          });\r\n          window.location.reload();\r\n    }\r\n\r\n    const remove = (id, image) => {\r\n        Axios.post('http://localhost:8000/api/admin/remove', {id: id}, {withCredentials: true})\r\n        .then(() => {\r\n            const storageRef = app.storage().ref();\r\n            storageRef.child(image).delete();\r\n            window.location.reload();\r\n        })\r\n        .catch(() => props.history.push('/error'));\r\n    }\r\n\r\n    const bookList = books.map(book => {\r\n        return <Book book={book} remove={remove} key={book.title}/>;\r\n    });\r\n\r\n    if(loading){\r\n        return <div className=\"loading-container\"><BeatLoader loading/></div>;\r\n    }\r\n    \r\n    return (\r\n        <div>\r\n            <button onClick={() => props.history.push('/admin')}>Back to admin panel</button>   \r\n            <h1 className=\"genre-title\">{genre}</h1>\r\n            <div className=\"sort-options-container\">\r\n                <form className=\"order-by-form\">\r\n                    <label>\r\n                        Order by:&nbsp;\r\n                        <select value={sortBy} onChange={(e) => redirect(genre, e.target.value, descending)}>\r\n                            <option value=\"title\">Title</option>\r\n                            <option value=\"author\">Author</option>\r\n                            <option value=\"price\">Price</option>\r\n                        </select>\r\n                    </label>\r\n                    <button type=\"button\" onClick={() => redirect(genre, sortBy, descending === 'true' ? 'false' : 'true')}>\r\n                    {descending === 'true' ? <DescendingIcon width=\"20\" height=\"20\"/> \r\n                    : <AscendingIcon width=\"20\" height=\"20\"/>}\r\n                </button>  \r\n                </form>             \r\n            </div>\r\n            <div className=\"book-container\">\r\n                {bookList}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withRouter(Books);"]},"metadata":{},"sourceType":"module"}