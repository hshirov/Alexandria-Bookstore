{"ast":null,"code":"import _slicedToArray from\"D:/Projects/Alexandria/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from'react';import Axios from'axios';import{withRouter}from'react-router-dom';import{BeatLoader}from'react-spinners';import{toast}from'react-toastify';import'../css/books.css';import'react-toastify/dist/ReactToastify.css';import Navigation from'./partial/navigation';import Book from'./partial/book';import{DescendingIcon,AscendingIcon}from'./partial/icons';var qs=require('qs');function Books(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).genre),_useState4=_slicedToArray(_useState3,1),genre=_useState4[0];var _useState5=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).orderby),_useState6=_slicedToArray(_useState5,1),sortBy=_useState6[0];var _useState7=useState(qs.parse(props.location.search,{ignoreQueryPrefix:true}).descending),_useState8=_slicedToArray(_useState7,1),descending=_useState8[0];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];toast.configure();useEffect(function(){var mounted=true;var APIRequest=\"http://localhost:8000/api/books/getAll?genre=\".concat(genre?genre:'',\"&orderby=\").concat(sortBy?sortBy:'title',\"&descending=\").concat(descending?descending:'false');Axios.get(APIRequest,{withCredentials:true}).then(function(res){if(mounted){setBooks(res.data);setLoading(false);}}).catch(function(){return props.history.push('/error');});return function(){mounted=false;};},[genre,descending,sortBy,props.history]);var addToBasket=function addToBasket(id){Axios.get(\"http://localhost:8000/api/basket/add/\".concat(id),{withCredentials:true}).then(function(){toast.info(\"Book added to basket!\",{position:toast.POSITION.BOTTOM_RIGHT,pauseOnHover:false,autoClose:2000});});};// Saves the sorting options in the URL\nvar redirect=function redirect(genre,orderBy,descending){props.history.push({pathname:'/books',search:\"?genre=\".concat(genre?genre:'',\"&orderby=\").concat(orderBy?orderBy:'title',\"&descending=\").concat(descending?descending:'false')});window.location.reload();};var bookList=books.map(function(book){return/*#__PURE__*/_jsx(Book,{book:book,addToBasket:addToBasket},book.title);});if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(BeatLoader,{loading:true})});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Navigation,{}),/*#__PURE__*/_jsx(\"h1\",{className:\"genre-title\",children:genre}),/*#__PURE__*/_jsx(\"div\",{className:\"sort-options-container\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"order-by-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Order by:\\xA0\",/*#__PURE__*/_jsxs(\"select\",{value:sortBy,onChange:function onChange(e){return redirect(genre,e.target.value,descending);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"author\",children:\"Author\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price\",children:\"Price\"})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return redirect(genre,sortBy,descending==='true'?'false':'true');},children:descending==='true'?/*#__PURE__*/_jsx(DescendingIcon,{width:\"20\",height:\"20\"}):/*#__PURE__*/_jsx(AscendingIcon,{width:\"20\",height:\"20\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"book-container\",children:bookList})]});}export default withRouter(Books);","map":{"version":3,"sources":["D:/Projects/Alexandria/client/src/components/books.jsx"],"names":["React","useState","useEffect","Axios","withRouter","BeatLoader","toast","Navigation","Book","DescendingIcon","AscendingIcon","qs","require","Books","props","books","setBooks","parse","location","search","ignoreQueryPrefix","genre","orderby","sortBy","descending","loading","setLoading","configure","mounted","APIRequest","get","withCredentials","then","res","data","catch","history","push","addToBasket","id","info","position","POSITION","BOTTOM_RIGHT","pauseOnHover","autoClose","redirect","orderBy","pathname","window","reload","bookList","map","book","title","e","target","value"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport Axios from 'axios';\r\nimport {withRouter} from 'react-router-dom';\r\nimport {BeatLoader} from 'react-spinners';\r\nimport {toast} from 'react-toastify';\r\nimport '../css/books.css';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport Navigation from './partial/navigation';\r\nimport Book from './partial/book';\r\nimport {DescendingIcon, AscendingIcon} from './partial/icons';\r\nconst qs = require('qs');\r\n\r\nfunction Books(props){\r\n    const [books, setBooks] = useState([]);\r\n    const [genre] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).genre);\r\n    const [sortBy] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).orderby);\r\n    const [descending] = useState(qs.parse(props.location.search, {ignoreQueryPrefix: true}).descending);\r\n    const [loading, setLoading] = useState(true);\r\n    toast.configure();\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n        \r\n        const APIRequest = `http://localhost:8000/api/books/getAll?genre=${genre ? genre : ''}&orderby=${sortBy ? sortBy : 'title'}&descending=${descending ? descending : 'false'}`;\r\n        Axios.get(APIRequest, {withCredentials: true})\r\n        .then(res => {\r\n            if(mounted){\r\n                setBooks(res.data);\r\n                setLoading(false);\r\n            }\r\n        })\r\n        .catch(() => props.history.push('/error'));\r\n        \r\n        return () => {\r\n            mounted = false;\r\n        }\r\n    }, [genre, descending, sortBy, props.history]);\r\n\r\n    const addToBasket = (id) => {\r\n        Axios.get(`http://localhost:8000/api/basket/add/${id}`, {withCredentials: true})\r\n        .then(() => {toast.info(\"Book added to basket!\", {position: toast.POSITION.BOTTOM_RIGHT, pauseOnHover: false, autoClose: 2000})});\r\n    };\r\n\r\n    // Saves the sorting options in the URL\r\n    const redirect = (genre, orderBy, descending) => {\r\n        props.history.push({\r\n            pathname: '/books',\r\n            search: `?genre=${genre ? genre : ''}&orderby=${orderBy ? orderBy : 'title'}&descending=${descending ? descending : 'false'}`\r\n          })\r\n          window.location.reload();\r\n    }\r\n\r\n    const bookList = books.map(book => {\r\n        return(\r\n            <Book book={book} key={book.title} addToBasket={addToBasket}/>\r\n        );\r\n    });\r\n\r\n    if(loading){\r\n        return <div className=\"loading-container\"><BeatLoader loading/></div>;\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Navigation />\r\n            <h1 className=\"genre-title\">{genre}</h1>\r\n            <div className=\"sort-options-container\">\r\n                <form className=\"order-by-form\">\r\n                    <label>\r\n                        Order by:&nbsp;\r\n                        <select value={sortBy} onChange={(e) => redirect(genre, e.target.value, descending)}>\r\n                            <option value=\"title\">Title</option>\r\n                            <option value=\"author\">Author</option>\r\n                            <option value=\"price\">Price</option>\r\n                        </select>\r\n                    </label>\r\n                    <button type=\"button\" onClick={() => redirect(genre, sortBy, descending === 'true' ? 'false' : 'true')}>\r\n                    {descending === 'true' ? <DescendingIcon width=\"20\" height=\"20\"/> : <AscendingIcon width=\"20\" height=\"20\"/>}\r\n                </button>  \r\n                </form>\r\n            </div>\r\n            <div className=\"book-container\">\r\n                {bookList}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withRouter(Books);"]},"metadata":{},"sourceType":"module"}